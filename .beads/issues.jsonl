{"id":"contrast-ai-smartfix-action-0dj","title":"Create shared test helper modules","description":"Create test_helpers/ directory with agent_patches.py, build_patches.py, api_patches.py, common_patches.py containing reusable patch lists for consistent mocking across test files.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T14:34:30.374819-05:00","updated_at":"2026-01-05T15:35:09.050783-05:00","closed_at":"2026-01-05T15:35:09.050783-05:00"}
{"id":"contrast-ai-smartfix-action-31m","title":"Improve Build/Test Workflow test coverage (19-27% → 70%)","description":"Add comprehensive tests for build_runner.py and formatter.py. Cover build execution, output capture, timeouts, formatter execution and graceful degradation. Test command validation security.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-05T14:34:31.598607-05:00","updated_at":"2026-01-05T15:46:45.143289-05:00","closed_at":"2026-01-05T15:46:45.143289-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-31m","depends_on_id":"contrast-ai-smartfix-action-gnt","type":"blocks","created_at":"2026-01-05T14:34:54.906973-05:00","created_by":"daemon"},{"issue_id":"contrast-ai-smartfix-action-31m","depends_on_id":"contrast-ai-smartfix-action-0dj","type":"blocks","created_at":"2026-01-05T14:34:55.017205-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-61p","title":"Improve Entry Point test coverage (32% → 60%)","description":"Add comprehensive tests for main.py orchestration. Cover SmartFix agent workflow, external agent workflows (Copilot/Claude), merge/closed handlers, version checking, config validation, top-level error handling.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-05T14:34:32.67711-05:00","updated_at":"2026-01-06T16:21:19.536285-05:00","closed_at":"2026-01-06T16:21:19.536285-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-61p","depends_on_id":"contrast-ai-smartfix-action-gnt","type":"blocks","created_at":"2026-01-05T14:34:55.345082-05:00","created_by":"daemon"},{"issue_id":"contrast-ai-smartfix-action-61p","depends_on_id":"contrast-ai-smartfix-action-0dj","type":"blocks","created_at":"2026-01-05T14:34:55.451589-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-6t4","title":"Add error logging to command validation","description":"Add _log_config_message() call in src/config.py line 206 before re-raising ConfigurationError. Log the CommandValidationError details to provide immediate feedback when command validation fails.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-07T15:24:23.903371-05:00","updated_at":"2026-01-08T13:09:55.916809-05:00"}
{"id":"contrast-ai-smartfix-action-8re","title":"Integrate validation into Config class","description":"Integrate command validation into src/config.py Config.__init__():\n- Import command_validator module\n- Add _validate_command() method to Config class\n- Call validation for BUILD_COMMAND after reading from environment (line ~82)\n- Call validation for FORMATTING_COMMAND after reading from environment (line ~84)\n- Ensure CommandValidationError is caught and converted to ConfigurationError\n- Follow existing config validation patterns (similar to _check_contrast_config_values_exist)\n- Maintain fail-fast behavior with clear error messages\n\nRelated to JIRA: AIML-337","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T09:50:37.859629-05:00","updated_at":"2025-12-23T10:34:27.5546-05:00","closed_at":"2025-12-23T10:34:27.5546-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-8re","depends_on_id":"contrast-ai-smartfix-action-gad","type":"blocks","created_at":"2025-12-23T09:51:11.594923-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-9hu","title":"Improve API Integration test coverage (28-66% → 70%)","description":"Add comprehensive tests for contrast_api.py, closed_handler.py, merge_handler.py. Cover HTTP error handling, timeouts, credit tracking, PR event handling, remediation status notifications.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-05T14:34:32.133956-05:00","updated_at":"2026-01-05T15:59:37.520196-05:00","closed_at":"2026-01-05T15:59:37.520196-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-9hu","depends_on_id":"contrast-ai-smartfix-action-gnt","type":"blocks","created_at":"2026-01-05T14:34:55.126797-05:00","created_by":"daemon"},{"issue_id":"contrast-ai-smartfix-action-9hu","depends_on_id":"contrast-ai-smartfix-action-0dj","type":"blocks","created_at":"2026-01-05T14:34:55.236813-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-cpi","title":"Improve SCM Operations test coverage (38-68% → 75%)","description":"Expand tests for github_operations.py (38% → 75%), fill gaps in git_operations.py and scm_operations.py. Focus on GitHub-specific operations: PR/issue creation, labels, GraphQL queries.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-05T14:34:33.129041-05:00","updated_at":"2026-01-06T16:38:37.943404-05:00","closed_at":"2026-01-06T16:38:37.943404-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-cpi","depends_on_id":"contrast-ai-smartfix-action-gnt","type":"blocks","created_at":"2026-01-05T14:34:55.560893-05:00","created_by":"daemon"},{"issue_id":"contrast-ai-smartfix-action-cpi","depends_on_id":"contrast-ai-smartfix-action-0dj","type":"blocks","created_at":"2026-01-05T14:34:55.670578-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-dtc","title":"Test event_loop_utils.py (13% → 70%)","description":"Add comprehensive tests for event_loop_utils.py async event loop management.\n\nCurrent coverage: 13%\nTarget: 70%\n\nCritical paths:\n- _run_agent_in_event_loop: event loop creation/cleanup, platform-specific setup (Windows vs Unix)\n- Agent execution with success/exceptions/timeouts\n- Event loop cleanup on errors\n- Multiple sequential agent runs\n\nTest cases:\n- Successful agent execution\n- Agent exception handling with cleanup\n- Timeout scenarios\n- Platform-specific behavior (Windows ProactorEventLoop)\n- Event loop contamination prevention\n\nMocking:\n- Agent execution (LLM calls)\n- asyncio.new_event_loop, asyncio.set_event_loop\n- platform.system\n- File operations\n\nReference: docs/plans/2026-01-05-test-coverage-improvement-design.md lines 100-135","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T16:38:21.109343-05:00","updated_at":"2026-01-06T13:07:30.1321-05:00","closed_at":"2026-01-06T13:07:30.1321-05:00"}
{"id":"contrast-ai-smartfix-action-e0r","title":"Test sub_agent_executor.py (50% → 70%)","description":"Add comprehensive tests for sub_agent_executor.py sub-agent orchestration logic.\n\nCurrent coverage: 50%\nTarget: 70%\n\nCritical paths:\n- Spawning sub-agents\n- Collecting results\n- Handling sub-agent failures\n- Timeout management\n\nTest cases:\n- Execute sub-agent successfully\n- Sub-agent throws exception (isolation)\n- Sub-agent timeout\n- Multiple parallel sub-agents\n- Result aggregation\n\nMocking:\n- LLM client calls\n- Agent execution\n- All I/O operations\n\nReference: docs/plans/2026-01-05-test-coverage-improvement-design.md lines 136-157","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T16:38:36.097839-05:00","updated_at":"2026-01-06T16:07:23.475848-05:00","closed_at":"2026-01-06T16:07:23.475848-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-e0r","depends_on_id":"contrast-ai-smartfix-action-uoy","type":"blocks","created_at":"2026-01-05T16:38:41.752737-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-gad","title":"Create command validation module","description":"Create src/smartfix/config/command_validator.py with:\n- ALLOWED_COMMANDS constant (full allowlist for Java, .NET, Python, PHP, NodeJS, build tools, shell utilities)\n- BLOCKED_PATTERNS regex list (command substitution, eval, exec, dangerous operations)\n- validate_shell_command() - ensures sh/bash only execute .sh files, blocks -c flag\n- validate_redirect() - allows relative paths only, blocks absolute paths and .. traversal\n- contains_dangerous_patterns() - checks command against blocked patterns\n- split_command_chain() - parses commands by operators (\u0026\u0026, ||, ;, |)\n- parse_command_segment() - extracts executable and arguments from command segment\n- extract_redirects() - finds file redirects in command\n- validate_command() - main validation function that orchestrates all checks\n- CommandValidationError exception class\n\nRelated to JIRA: AIML-337","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-23T09:49:50.169966-05:00","updated_at":"2025-12-23T10:28:03.234049-05:00","closed_at":"2025-12-23T10:28:03.234049-05:00"}
{"id":"contrast-ai-smartfix-action-gnt","title":"Add coverage target to Makefile","description":"Add 'make coverage' target to run tests with coverage.py and generate HTML reports. This is a prerequisite for all other test work.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-05T14:34:17.89705-05:00","updated_at":"2026-01-05T14:54:39.771242-05:00","closed_at":"2026-01-05T14:54:39.771242-05:00"}
{"id":"contrast-ai-smartfix-action-iuo","title":"Improve Agent Orchestration test coverage (10-27% → 70%)","description":"Add comprehensive tests for smartfix_agent.py, event_loop_utils.py, sub_agent_executor.py, mcp_manager.py. Focus on remediation workflow, async event loops, sub-agent execution, and MCP connection lifecycle. Use full mocking pattern.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-05T14:34:31.000974-05:00","updated_at":"2026-01-05T16:38:48.182515-05:00","closed_at":"2026-01-05T16:38:48.182515-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-iuo","depends_on_id":"contrast-ai-smartfix-action-gnt","type":"blocks","created_at":"2026-01-05T14:34:54.665564-05:00","created_by":"daemon"},{"issue_id":"contrast-ai-smartfix-action-iuo","depends_on_id":"contrast-ai-smartfix-action-0dj","type":"blocks","created_at":"2026-01-05T14:34:54.794003-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-ix3","title":"Add tests for source-based command validation","description":"Create comprehensive tests for the new source parameter in _validate_command. Test cases: 1) config-sourced commands skip validation (including dangerous patterns), 2) ai_detected commands go through full validation, 3) backward compatibility with default parameter. Add tests to test/test_config_integration.py.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T15:28:06.081383-05:00","updated_at":"2026-01-08T11:01:55.118122-05:00","closed_at":"2026-01-08T11:00:36.265023-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-ix3","depends_on_id":"contrast-ai-smartfix-action-ue9","type":"blocks","created_at":"2026-01-07T15:31:18.793851-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-p4l","title":"Implement graceful degradation for formatter failures","description":"Code review identified that formatter.py calls error_exit() on all failures, but the design plan requires graceful degradation (log warning and continue). Formatter should be best-effort - if it fails, log a warning and allow the remediation to continue. This aligns with industry best practices where formatters are optional quality-of-life tools.\n\nAffected file: src/smartfix/domains/workflow/formatter.py:75\nRequired changes:\n1. Replace error_exit() call with warning log\n2. Update tests to verify warnings instead of error_exit calls\n3. Add test for continued execution after formatter failure\n\nReference: Test Coverage Improvement Plan - Build/Test Workflow section","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T15:46:33.475021-05:00","updated_at":"2026-01-05T16:29:50.210724-05:00","closed_at":"2026-01-05T16:29:50.210728-05:00"}
{"id":"contrast-ai-smartfix-action-q9y","title":"Create comprehensive test suite for command validation","description":"Create test/test_command_validation.py with comprehensive test coverage:\n- Test all allowed commands validate successfully (Java, .NET, Python, PHP, NodeJS, build tools)\n- Test blocked executables are rejected with proper error messages\n- Test command chaining with operators (\u0026\u0026, ||, ;, |)\n- Test shell script execution: sh/bash with .sh files allowed, -c flag blocked\n- Test redirect validation: relative paths pass, absolute paths and .. traversal fail\n- Test dangerous pattern detection: command substitution, eval, exec, piping to shell\n- Test edge cases: empty commands, whitespace, special characters, complex chains\n- Test error messages are clear and actionable\n- Ensure all tests pass and maintain existing test coverage (165+ tests)\n\nRelated to JIRA: AIML-337","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T09:51:20.598647-05:00","updated_at":"2025-12-23T10:35:10.53909-05:00","closed_at":"2025-12-23T10:35:10.53909-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-q9y","depends_on_id":"contrast-ai-smartfix-action-gad","type":"blocks","created_at":"2025-12-23T09:51:56.723262-05:00","created_by":"daemon"},{"issue_id":"contrast-ai-smartfix-action-q9y","depends_on_id":"contrast-ai-smartfix-action-8re","type":"blocks","created_at":"2025-12-23T09:51:56.843412-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-t5c","title":"Add sbt to command allowlist","description":"Add 'sbt' (Scala Build Tool) to the ALLOWED_COMMANDS list in src/smartfix/config/command_validator.py line 46, alongside other Java/Scala build tools (mvn, gradle, ant).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T15:18:12.66074-05:00","updated_at":"2026-01-08T13:09:55.918101-05:00","closed_at":"2026-01-08T11:44:58.178248-05:00"}
{"id":"contrast-ai-smartfix-action-ue9","title":"Add source parameter to _validate_command for config vs AI-generated commands","description":"Modify _validate_command() in src/config.py to accept a 'source' parameter ('config' or 'ai_detected'). Config-sourced commands (from action.yml inputs) should skip allowlist validation as they come from trusted humans. AI-generated commands (future feature) should go through full validation. Update Config.__init__ to pass source='config' for BUILD_COMMAND and FORMATTING_COMMAND. Add logging to indicate when validation is skipped. This prepares infrastructure for the AI agent feature coming within next 1-2 weeks.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-07T15:25:48.489324-05:00","updated_at":"2026-01-08T09:59:52.425005-05:00","closed_at":"2026-01-08T09:58:40.224241-05:00"}
{"id":"contrast-ai-smartfix-action-uoy","title":"Test smartfix_agent.py (25% → 70%)","description":"Add comprehensive tests for smartfix_agent.py remediation workflow state machine.\n\nCurrent coverage: 25%\nTarget: 70%\n\nCritical paths:\n- Initial build validation (pass/fail)\n- Fix agent execution (success/failure)\n- QA loop (success/retry/failure)\n- Session completion (all failure categories)\n\nTest cases:\n- Build fails before fix → INITIAL_BUILD_FAILURE\n- Fix agent succeeds, no build command → immediate success\n- Fix agent succeeds, QA passes → success\n- Fix agent succeeds, QA exhausts retries → QA_FAILURE\n- Fix agent throws exception → AGENT_FAILURE\n- Build never passes after fix → BUILD_FAILURE\n\nMocking:\n- _run_ai_fix_agent (return mock PR body or None)\n- _run_ai_qa_agent (return success/failure)\n- run_build_command (return success/failure + output)\n- All git operations\n\nReference: docs/plans/2026-01-05-test-coverage-improvement-design.md lines 78-99","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T16:38:29.814352-05:00","updated_at":"2026-01-06T14:43:29.3548-05:00","closed_at":"2026-01-06T14:43:29.3548-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-uoy","depends_on_id":"contrast-ai-smartfix-action-dtc","type":"blocks","created_at":"2026-01-05T16:38:41.610258-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-wuv","title":"Update documentation for command allowlist","description":"Update README.md and related documentation:\n- Add new section explaining command allowlist security feature\n- Document all allowed commands organized by language/ecosystem\n- Document allowed operators for chaining (\u0026\u0026, ||, ;, |)\n- Document allowed redirect patterns (relative paths only)\n- Provide examples of valid commands for each language\n- Provide examples of blocked commands and why they fail\n- Document error messages users might encounter\n- Add troubleshooting section for common validation failures\n- Update security.md if present to mention this security feature\n\nRelated to JIRA: AIML-337","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-23T09:52:22.925762-05:00","updated_at":"2025-12-23T10:40:22.502328-05:00","closed_at":"2025-12-23T10:40:22.502328-05:00","dependencies":[{"issue_id":"contrast-ai-smartfix-action-wuv","depends_on_id":"contrast-ai-smartfix-action-q9y","type":"blocks","created_at":"2025-12-23T09:52:26.450395-05:00","created_by":"daemon"}]}
{"id":"contrast-ai-smartfix-action-z4l","title":"Create LLM-as-judge prompt for E2E test repo PR reviews","description":"Create a reusable code review prompt for evaluating SmartFix's cybersecurity fixes in E2E test repos.\n\nPROMPT STRUCTURE:\n1. **Discovery Phase**\n   - Fetch open PRs using gh CLI\n   - Identify PRs created by SmartFix\n   - Extract vulnerability description from PR body\n   - Identify vulnerability type (SQL injection, XSS, path traversal, etc.)\n\n2. **Evaluation Criteria (Vulnerability-Agnostic)**\n   - Does the fix address the specific vulnerability described in PR body?\n   - Are all attack vectors for that vulnerability type blocked?\n   - Input validation appropriate for the vulnerability type\n   - Output encoding/sanitization where needed\n   - No introduction of new vulnerabilities\n   - Test coverage for the specific vulnerability\n\n3. **Review Process**\n   - Parse PR body to understand the vulnerability\n   - Fetch PR diff and files changed\n   - Analyze if code changes eliminate the vulnerability\n   - Check for incomplete fixes or edge cases\n   - **CRITICAL: If any problems are flagged:**\n     - Read surrounding code context (not just the diff)\n     - Trace the data flow to confirm the vulnerability path\n     - Verify the issue truly exists before reporting it\n     - Check if existing code already handles the concern\n     - Avoid false positives by validating assumptions\n   - Verify test cases cover the vulnerability scenario\n   - Assess if fix follows security best practices for that vuln type\n\n4. **Report Format**\n   - Vulnerability type and description (from PR)\n   - Fix effectiveness assessment\n   - Does fix address the vulnerability? (YES/NO/PARTIAL)\n   - Strengths of the fix\n   - Gaps or weaknesses in the fix (ONLY if confirmed by reading surrounding code)\n   - Attack vectors still exploitable (if any, with code evidence)\n   - Test coverage assessment\n   - Recommendations for improvement\n\nLOCATION:\ntest/prompts/smartfix-security-review.md\n\nUSAGE:\nUser runs Claude Code in E2E test repo and provides the prompt, which instructs Claude to review all open SmartFix PRs by matching code changes against the vulnerability described in each PR body.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-23T13:12:19.227567-05:00","updated_at":"2025-12-23T13:52:04.993954-05:00","closed_at":"2025-12-23T13:52:04.993954-05:00"}
